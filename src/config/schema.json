{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/agent-config.schema.json",
  "title": "Universal Agent Configuration",
  "description": "Configuration schema for the Universal Agent in the workspace-centric architecture",
  "type": "object",
  "required": ["agent_id", "display_name", "llm", "workspace", "tools", "connections"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "agent_id": {
      "type": "string",
      "description": "Unique identifier for this agent type",
      "pattern": "^[a-z][a-z0-9_-]*$",
      "examples": ["creator", "validator"]
    },
    "display_name": {
      "type": "string",
      "description": "Human-readable name for the agent",
      "examples": ["Creator Agent", "Validator Agent"]
    },
    "description": {
      "type": "string",
      "description": "Brief description of what this agent does"
    },
    "llm": {
      "type": "object",
      "description": "LLM configuration",
      "required": ["model"],
      "properties": {
        "model": {
          "type": "string",
          "description": "Model identifier",
          "examples": ["gpt-oss-120b", "gpt-4o", "claude-3-opus"]
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 0.0,
          "description": "Sampling temperature"
        },
        "reasoning_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "high",
          "description": "Reasoning depth for models that support it"
        },
        "base_url": {
          "type": ["string", "null"],
          "description": "Custom API base URL (null for default)"
        },
        "timeout": {
          "type": ["number", "null"],
          "minimum": 1,
          "default": 600,
          "description": "Request timeout in seconds (null for no timeout, default 600s = 10 minutes)"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3,
          "description": "Number of retries for failed LLM requests with exponential backoff"
        }
      }
    },
    "workspace": {
      "type": "object",
      "description": "Workspace configuration",
      "required": ["structure", "instructions_template"],
      "properties": {
        "structure": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Directories to create in the workspace",
          "examples": [["archive/", "output/", "tools/"]]
        },
        "instructions_template": {
          "type": "string",
          "description": "Name of the instructions template file"
        },
        "initial_files": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Files to copy into workspace on initialization. Keys are destination paths, values are source paths relative to src/agent/config/"
        },
        "max_read_size": {
          "type": "integer",
          "minimum": 1000,
          "default": 50000,
          "description": "Maximum file size in characters for workspace read operations"
        }
      }
    },
    "tools": {
      "type": "object",
      "description": "Tool configuration by category",
      "required": ["workspace", "todo"],
      "properties": {
        "workspace": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Workspace tools to enable",
          "examples": [["read_file", "write_file", "list_files"]]
        },
        "todo": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Todo tools to enable",
          "examples": [["add_todo", "complete_todo", "list_todos"]]
        },
        "domain": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Domain-specific tools to enable"
        },
        "completion": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Phase/job completion signaling tools to enable",
          "examples": [["mark_complete", "job_complete"]]
        }
      }
    },
    "todo": {
      "type": "object",
      "description": "TodoManager configuration",
      "properties": {
        "max_items": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 25,
          "description": "Maximum number of active todos"
        },
        "archive_on_reset": {
          "type": "boolean",
          "default": true,
          "description": "Archive todos when resetting"
        },
        "archive_path": {
          "type": "string",
          "default": "archive/",
          "description": "Workspace path for archived todos"
        }
      }
    },
    "connections": {
      "type": "object",
      "description": "Database connections required",
      "required": ["postgres"],
      "properties": {
        "postgres": {
          "type": "boolean",
          "description": "Whether PostgreSQL is required"
        },
        "neo4j": {
          "type": "boolean",
          "default": false,
          "description": "Whether Neo4j is required"
        }
      }
    },
    "polling": {
      "type": "object",
      "description": "Database polling configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable polling mode"
        },
        "table": {
          "type": "string",
          "description": "Table to poll for work"
        },
        "status_field": {
          "type": "string",
          "description": "Field containing status"
        },
        "status_value_pending": {
          "type": "string",
          "default": "pending",
          "description": "Status value for pending items"
        },
        "status_value_processing": {
          "type": "string",
          "default": "processing",
          "description": "Status value for items being processed"
        },
        "status_value_complete": {
          "type": "string",
          "default": "complete",
          "description": "Status value for completed items"
        },
        "status_value_failed": {
          "type": "string",
          "default": "failed",
          "description": "Status value for failed items"
        },
        "interval_seconds": {
          "type": "integer",
          "minimum": 1,
          "default": 10,
          "description": "Polling interval in seconds"
        },
        "use_skip_locked": {
          "type": "boolean",
          "default": false,
          "description": "Use SKIP LOCKED for concurrent processing"
        }
      }
    },
    "limits": {
      "type": "object",
      "description": "Execution limits",
      "properties": {
        "context_threshold_tokens": {
          "type": "integer",
          "minimum": 1000,
          "default": 80000,
          "description": "Token threshold for context compaction"
        },
        "message_count_threshold": {
          "type": "integer",
          "minimum": 1,
          "default": 200,
          "description": "Message count threshold for triggering summarization (requires min tokens too)"
        },
        "message_count_min_tokens": {
          "type": "integer",
          "minimum": 1000,
          "default": 30000,
          "description": "Minimum token count required when using message count threshold"
        },
        "tool_retry_count": {
          "type": "integer",
          "minimum": 0,
          "default": 3,
          "description": "Number of retries for failed tool calls"
        }
      }
    },
    "context_management": {
      "type": "object",
      "description": "Context management configuration",
      "properties": {
        "compact_on_archive": {
          "type": "boolean",
          "default": true,
          "description": "Trigger context compaction when archiving todos"
        },
        "keep_recent_tool_results": {
          "type": "integer",
          "minimum": 0,
          "default": 10,
          "description": "Number of recent tool results to keep in full"
        },
        "keep_recent_messages": {
          "type": "integer",
          "minimum": 1,
          "default": 10,
          "description": "Number of recent messages to preserve during compaction and trimming"
        },
        "summarization_template": {
          "type": "string",
          "description": "Filename of summarization prompt template (in prompts/ folder)",
          "default": "summarization_prompt.txt"
        },
        "reasoning_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "high",
          "description": "Reasoning effort level hint for summarization (injected as {oss_reasoning_level})"
        },
        "max_summary_length": {
          "type": "integer",
          "minimum": 1000,
          "default": 10000,
          "description": "Maximum summary length in tokens (injected as {max_summary_length} in prompt)"
        }
      }
    },
    "document_processing": {
      "type": "object",
      "description": "Document processing configuration",
      "properties": {
        "chunking_strategy": {
          "type": "string",
          "enum": ["general", "semantic", "fixed"],
          "default": "general",
          "description": "Strategy for splitting documents into chunks"
        },
        "max_chunk_size": {
          "type": "integer",
          "minimum": 100,
          "default": 1000,
          "description": "Maximum chunk size in tokens"
        },
        "chunk_overlap": {
          "type": "integer",
          "minimum": 0,
          "default": 200,
          "description": "Overlap between chunks in tokens"
        },
        "extraction_mode": {
          "type": "string",
          "enum": ["balanced", "thorough", "fast"],
          "default": "balanced",
          "description": "Extraction thoroughness mode"
        },
        "min_confidence_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.5,
          "description": "Minimum confidence score for extracted items"
        }
      }
    },
    "research": {
      "type": "object",
      "description": "Research capabilities configuration",
      "properties": {
        "web_search_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable web search during processing"
        },
        "graph_search_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable knowledge graph search during processing"
        },
        "research_depth": {
          "type": "string",
          "enum": ["minimal", "standard", "deep"],
          "default": "standard",
          "description": "Depth of research to perform"
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "Validation and integration configuration",
      "properties": {
        "duplicate_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.9,
          "description": "Similarity threshold for duplicate detection"
        },
        "require_citations": {
          "type": "boolean",
          "default": false,
          "description": "Whether citations are required for validation"
        },
        "metamodel_validation_strict": {
          "type": "boolean",
          "default": false,
          "description": "Enable strict metamodel validation"
        },
        "fulfillment_confidence_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.5,
          "description": "Minimum confidence for requirement fulfillment"
        },
        "auto_integrate": {
          "type": "boolean",
          "default": false,
          "description": "Automatically integrate validated items into the knowledge graph"
        }
      }
    }
  },
  "additionalProperties": true
}
