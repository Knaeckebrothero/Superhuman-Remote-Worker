{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/agent-config.schema.json",
  "title": "Universal Agent Configuration",
  "description": "Configuration schema for the Universal Agent in the workspace-centric architecture",
  "type": "object",
  "required": ["agent_id", "display_name", "llm", "workspace", "tools", "connections"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "agent_id": {
      "type": "string",
      "description": "Unique identifier for this agent type",
      "pattern": "^[a-z][a-z0-9_-]*$",
      "examples": ["creator", "validator"]
    },
    "display_name": {
      "type": "string",
      "description": "Human-readable name for the agent",
      "examples": ["Creator Agent", "Validator Agent"]
    },
    "description": {
      "type": "string",
      "description": "Brief description of what this agent does"
    },
    "icon": {
      "type": "string",
      "description": "Material Symbols icon name for expert discovery UI",
      "default": "psychology",
      "examples": ["science", "edit_note", "search"]
    },
    "color": {
      "type": "string",
      "description": "Accent color (hex) for expert discovery UI",
      "default": "#cba6f7",
      "pattern": "^#[0-9a-fA-F]{6}$",
      "examples": ["#89b4fa", "#a6e3a1", "#f9e2af"]
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Tags for categorization and filtering in expert discovery",
      "examples": [["research", "academic"], ["documentation", "writing"]]
    },
    "llm": {
      "type": "object",
      "description": "LLM configuration with optional phase-specific overrides",
      "required": ["model"],
      "properties": {
        "model": {
          "type": "string",
          "description": "Default model identifier (used when no phase override)",
          "examples": ["gpt-oss-120b", "gpt-4o", "claude-sonnet-4-20250514", "gemini-2.0-flash"]
        },
        "provider": {
          "type": ["string", "null"],
          "enum": ["openai", "anthropic", "google", "groq", null],
          "default": null,
          "description": "LLM provider. Auto-detected from model name if null (claude-* → anthropic, gemini-* → google, default → openai). Groq requires explicit setting."
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 0.0,
          "description": "Sampling temperature"
        },
        "reasoning_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "high",
          "description": "Reasoning depth for models that support it"
        },
        "base_url": {
          "type": ["string", "null"],
          "description": "Custom API base URL (null for default)"
        },
        "timeout": {
          "type": ["number", "null"],
          "minimum": 1,
          "default": 600,
          "description": "Request timeout in seconds (null for no timeout, default 600s = 10 minutes)"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3,
          "description": "Number of retries for failed LLM requests with exponential backoff"
        },
        "multimodal": {
          "type": "boolean",
          "default": false,
          "description": "Whether the primary model can process images directly. When true, visual content (document screenshots, images) is sent as base64-encoded images. When false, visual content is converted to text descriptions via a separate vision model."
        },
        "strategic": {
          "$ref": "#/$defs/llmPhaseOverride",
          "description": "LLM overrides for strategic (planning) phases. Uses more capable models for high-level decisions."
        },
        "tactical": {
          "$ref": "#/$defs/llmPhaseOverride",
          "description": "LLM overrides for tactical (execution) phases. Can use faster/cheaper models for task execution."
        },
        "summarization": {
          "$ref": "#/$defs/llmPhaseOverride",
          "description": "LLM overrides for context summarization. Can use different model for compacting conversation history."
        }
      }
    },
    "workspace": {
      "type": "object",
      "description": "Workspace configuration",
      "required": ["structure", "instructions_template"],
      "properties": {
        "structure": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Directories to create in the workspace",
          "examples": [["archive/", "output/", "tools/"]]
        },
        "instructions_template": {
          "type": "string",
          "description": "Name of the instructions template file"
        },
        "initial_files": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Files to copy into workspace on initialization. Keys are destination paths, values are source paths relative to src/agent/config/"
        },
        "max_read_words": {
          "type": "integer",
          "minimum": 100,
          "default": 25000,
          "description": "Maximum word count for workspace read operations. For non-PDF files, estimated from file size (bytes / 5.5). For PDFs, counted during page iteration."
        },
        "max_read_size": {
          "type": "integer",
          "minimum": 1000,
          "description": "DEPRECATED: Use max_read_words instead. If max_read_words is not set, falls back to max_read_size / 5.5."
        },
        "git_versioning": {
          "type": "boolean",
          "default": true,
          "description": "Enable git versioning for workspace history. Creates a git repository in the workspace for automatic change tracking."
        },
        "git_ignore_patterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["*.db", "*.log", "__pycache__/", ".DS_Store", "*.pyc"],
          "description": "Patterns for .gitignore when git versioning is enabled"
        }
      }
    },
    "tools": {
      "type": "object",
      "description": "Tool configuration by category (matches src/tools/ packages)",
      "required": ["workspace", "core"],
      "properties": {
        "workspace": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Workspace file operation tools (src/tools/workspace/)",
          "examples": [["read_file", "write_file", "list_files", "edit_file"]]
        },
        "core": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Core tools: todo management + job completion (src/tools/core/)",
          "examples": [["next_phase_todos", "todo_complete", "mark_complete", "job_complete"]]
        },
        "document": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Document processing tools (src/tools/document/)",
          "examples": [["chunk_document"]]
        },
        "research": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Research/web search tools (src/tools/research/)",
          "examples": [["web_search"]]
        },
        "citation": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Citation management tools (src/tools/citation/)",
          "examples": [["cite_document", "cite_web", "list_sources"]]
        },
        "graph": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Neo4j graph operation tools (src/tools/graph/)",
          "examples": [["execute_cypher_query", "get_database_schema"]]
        },
        "git": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Git version control tools for workspace history (src/tools/git/)",
          "examples": [["git_log", "git_show", "git_diff", "git_status", "git_tags"]]
        },
        "coding": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Coding/execution tools for shell command execution (src/tools/coding/)",
          "examples": [["run_command"]]
        }
      }
    },
    "connections": {
      "type": "object",
      "description": "Database connections required",
      "required": ["postgres"],
      "properties": {
        "postgres": {
          "type": "boolean",
          "description": "Whether PostgreSQL is required"
        },
        "neo4j": {
          "type": "boolean",
          "default": false,
          "description": "Whether Neo4j is required"
        }
      }
    },
    "limits": {
      "type": "object",
      "description": "Execution limits",
      "properties": {
        "context_threshold_tokens": {
          "type": "integer",
          "minimum": 1000,
          "default": 80000,
          "description": "Token threshold for context compaction"
        },
        "message_count_threshold": {
          "type": "integer",
          "minimum": 1,
          "default": 200,
          "description": "Message count threshold for triggering summarization (requires min tokens too)"
        },
        "message_count_min_tokens": {
          "type": "integer",
          "minimum": 1000,
          "default": 30000,
          "description": "Minimum token count required when using message count threshold"
        },
        "tool_retry_count": {
          "type": "integer",
          "minimum": 0,
          "default": 3,
          "description": "Number of retries for failed tool calls"
        },
        "model_max_context_tokens": {
          "type": "integer",
          "minimum": 1000,
          "default": 128000,
          "description": "Hard limit for model context window. Pre-request safety check will force summarization if exceeded."
        },
        "summarization_safe_limit": {
          "type": "integer",
          "minimum": 1000,
          "default": 100000,
          "description": "Maximum input tokens for summarization LLM. Larger inputs trigger recursive chunked summarization."
        },
        "summarization_chunk_size": {
          "type": "integer",
          "minimum": 1000,
          "default": 80000,
          "description": "Target chunk size in tokens when splitting for recursive summarization."
        }
      }
    },
    "context_management": {
      "type": "object",
      "description": "Context management configuration",
      "properties": {
        "compact_on_archive": {
          "type": "boolean",
          "default": true,
          "description": "Trigger context compaction when archiving todos"
        },
        "keep_recent_tool_results": {
          "type": "integer",
          "minimum": 0,
          "default": 10,
          "description": "Number of recent tool results to keep in full"
        },
        "keep_recent_messages": {
          "type": "integer",
          "minimum": 1,
          "default": 10,
          "description": "Number of recent messages to preserve during compaction and trimming"
        },
        "summarization_template": {
          "type": "string",
          "description": "Filename of summarization prompt template (in prompts/ folder)",
          "default": "summarization_prompt.txt"
        },
        "reasoning_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "high",
          "description": "Reasoning effort level hint for summarization (injected as {oss_reasoning_level})"
        },
        "max_summary_length": {
          "type": "integer",
          "minimum": 1000,
          "default": 10000,
          "description": "Maximum summary length in tokens (injected as {max_summary_length} in prompt)"
        }
      }
    },
    "research": {
      "type": "object",
      "description": "Research capabilities configuration",
      "properties": {
        "proxy": {
          "type": "object",
          "description": "Proxy configuration for institutional access (e.g., SSH tunnel to university VPN)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable proxy for research tool requests"
            },
            "type": {
              "type": "string",
              "enum": ["none", "http", "socks5"],
              "default": "socks5",
              "description": "Proxy type"
            },
            "host": {
              "type": ["string", "null"],
              "description": "Proxy host (e.g., 'localhost' for SSH tunnel)"
            },
            "port": {
              "type": ["integer", "null"],
              "description": "Proxy port (e.g., 1080 for SOCKS)"
            }
          }
        }
      }
    },
    "browser": {
      "type": "object",
      "description": "Browser automation configuration (browser-use + Playwright)",
      "properties": {
        "headless": {
          "type": "boolean",
          "default": true,
          "description": "Run browser without visible UI"
        },
        "timeout": {
          "type": "integer",
          "default": 60000,
          "description": "Browser operation timeout in milliseconds"
        },
        "use_vision": {
          "type": "boolean",
          "default": false,
          "description": "Use screenshot-based navigation instead of DOM/accessibility tree"
        }
      }
    }
  },
  "additionalProperties": true,
  "$defs": {
    "llmPhaseOverride": {
      "type": "object",
      "description": "Phase-specific LLM overrides. Only specified fields override the base config.",
      "properties": {
        "model": {
          "type": "string",
          "description": "Model identifier for this phase"
        },
        "provider": {
          "type": ["string", "null"],
          "enum": ["openai", "anthropic", "google", "groq", null],
          "description": "LLM provider override"
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Sampling temperature override"
        },
        "reasoning_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Reasoning depth override"
        },
        "base_url": {
          "type": ["string", "null"],
          "description": "Custom API base URL override"
        },
        "api_key": {
          "type": ["string", "null"],
          "description": "API key override (for different provider)"
        },
        "timeout": {
          "type": ["number", "null"],
          "minimum": 1,
          "description": "Request timeout override"
        },
        "max_retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "description": "Retry count override"
        }
      },
      "additionalProperties": false
    }
  }
}
