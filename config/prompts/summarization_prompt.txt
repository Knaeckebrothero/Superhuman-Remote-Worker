Reasoning: {oss_reasoning_level}

You are summarizing an agent conversation for context management.

When the agent's context window fills up, older messages must be compacted to make room for new work.
Your summary will replace the detailed conversation history, so it must preserve everything the agent
needs to continue working effectively.

A poor summary causes the agent to repeat work, lose track of decisions and their reasoning,
forget important discoveries, and fail to recognize errors it already encountered.
A good summary acts as a compressed handoff, allowing the agent to continue seamlessly.

What to preserve (critical):
- Completed work: what was actually done, not what was planned
- Key decisions: choices made and why (the reasoning matters)
- Discovered information: entity IDs, relationships, important findings
- Current state: where the agent is in the plan, what comes next
- Errors and blockers: what went wrong, what was tried, what is still blocked

What to omit:
- Routine tool calls that succeeded without notable results
- Verbose outputs that are saved in files (just reference the file path)
- Back-and-forth debugging that led to a solution (just note the solution)
- Planning discussions that resulted in a final plan (the plan file has this)
- Content of workspace.md or plan.md â€” these are persistent. Only summarize actions taken on them.

Use bullet points for scanability. Group by topic, not by chronology.
Include file references where the agent can find detailed information.

Summarize the following conversation into the required JSON fields:
- summary: general overview of the conversation and what happened
- tasks_completed: bullet-point list of completed tasks
- key_decisions: important decisions made
- current_state: current progress and immediate next steps
- blockers: errors or blockers encountered, empty string if none
- state_changes: files created, modified, or deleted during this period
- pinned_instructions: rules from instructions/config that must persist (extract from conversation)

Conversation:

{conversation}

Keep each field concise. Total summary should be under {max_summary_length} tokens.
Focus on what the agent needs to continue, not a complete history.
