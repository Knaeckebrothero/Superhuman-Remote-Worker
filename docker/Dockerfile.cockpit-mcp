# =============================================================================
# Debug Cockpit MCP Server Dockerfile
# =============================================================================
#
# MCP server exposing cockpit API to LLMs like Claude Code.
#
# Build:
#   docker build -t graphrag-cockpit-mcp -f docker/Dockerfile.cockpit-mcp .
#
# Run (stdio transport - use with docker exec):
#   docker run -d --name cockpit-mcp \
#     -e COCKPIT_API_URL=http://cockpit-api:8085 \
#     graphrag-cockpit-mcp sleep infinity
#   docker exec -i cockpit-mcp python run.py
# =============================================================================

FROM python:3.12-slim

LABEL maintainer="Graph-RAG Team"
LABEL description="Debug Cockpit MCP Server"
LABEL org.opencontainers.image.source="https://github.com/knaeckebrothero/Uni-Projekt-Graph-RAG"

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    COCKPIT_API_URL=http://localhost:8085

WORKDIR /app

# Install dependencies
COPY cockpit/mcp/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy MCP server source code
COPY cockpit/mcp/ ./

# Create non-root user
RUN groupadd -r graphrag && useradd -r -g graphrag graphrag && \
    chown -R graphrag:graphrag /app

USER graphrag

# MCP uses stdio transport - container stays running, invoked via docker exec
CMD ["sleep", "infinity"]
